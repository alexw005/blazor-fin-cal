@page "/"

<PageTitle>Financial Calculator</PageTitle>
<EditForm Model="@calcModel" OnValidSubmit="@Calculate">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="form-grid">
        <div class="form-group">
            <label>Principal Amount</label>
            <InputNumber @bind-Value="calcModel.Principal" class="input" />
        </div>

        <div class="form-group">
            <label>Interest Rate (%)</label>
            <InputNumber @bind-Value="calcModel.AnnualRate" class="input" />
        </div>

        <div class="form-group">
            <label>Years</label>
            <InputNumber @bind-Value="calcModel.Years" class="input" />
        </div>
    </div>

    <button type="submit" class="btn">Calculate</button>
</EditForm>

@if (result != null)
{
    <p>Total Interest = @result</p>
    <p>Total Payment = @totalPayment</p>
    <p>Montly Payment = @monthlyPayment</p>

}

@if (result.HasValue)
{
    <div class="result-box">
        <strong>Total Interest:</strong> @result.Value.ToString("C")
    </div>
     <div class="result-box">
        <strong>Total Payment:</strong> @totalPayment.Value.ToString("C")
    </div>
     <div class="result-box">
        <strong>Montly Payment:</strong> @monthlyPayment.Value.ToString("C")
    </div>
}

@code {
    private double principal { get; set; }
    private double annualRate { get; set; }
    private int years { get; set; }
    private double? result { get; set; }
    private double? totalPayment { get; set; }
    private double? monthlyPayment { get; set; }
    public class CalcModel
    {
        public double Principal { get; set; }
        public double AnnualRate { get; set; }
        public int Years { get; set; }
    }
    private CalcModel calcModel = new();

        
        
    private void Calculate()
    {
        double monthlyRate = (calcModel.AnnualRate / 100) / 12;
        int months = calcModel.Years * 12;

        // Calculate Monthly Payment (EMI) using the formula:
        // M = P [ i(1 + i)^n ] / [ (1 + i)^n – 1]
        // Where:
        // M = Monthly Payment
        // P = Principal Loan Amount
        // i = Monthly Interest Rate
        // n = Number of Months
        monthlyPayment = calcModel.Principal * (monthlyRate * Math.Pow(1 + monthlyRate, months)) / (Math.Pow(1 + monthlyRate, months) - 1);

        totalPayment = monthlyPayment * months;
        result = totalPayment - calcModel.Principal;
    }
    
}